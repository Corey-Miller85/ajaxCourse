<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSON Exercise</title>
</head>
<body>
    <h1>Learn JSON</h1>
    <div id="output">
        <ul id="taskList"></ul>
    </div>
    <form id="myForm">
        Task:
        <input type="text" name="task" placeholder="task">
        <input type="submit" value="add new task">
    </form>
    <script type="text/javascript">
        var dataJSON = '';
        var output = document.querySelector('#output');
        var taskList = document.querySelector('#taskList');

        document.getElementById("myForm").addEventListener('submit', (e) => {
            e.preventDefault();
            var tempValue = document.querySelector('#myForm input[name="task"]').value;
            console.log(tempValue)
            addNewItem({"info":tempValue, "status":false});
        });

        window.onload = () => {
            if (sessionStorage["task"] != null) {
                dataJSON = JSON.parse(sessionStorage["task"])
            } else {
                var data = '[{"info":"Cut Grass","status":false},{"info":"Clean Room","status":false},{"info":"Make Dinner","status":true},{"info":"Summon Demons","status":false},{"info":"End Capitalism","status":false}]';

                dataJSON = JSON.parse(data);
            }
            buildCheckboxes(dataJSON);
        };

        function addNewItem(data) {
            dataJSON.push(data);
            taskList.innerHTML += `<li> ${data.info} <input type="checkbox" value="${dataJSON.length}" ${status}> </li>`;

        }

        function buildCheckboxes(data){
            for (var key in data) {
                let status = data[key].status ? 'checked': '';
                var html = `<li> ${data[key].info} <input type="checkbox" value="${key}" ${status}> </li>`;
                taskList.innerHTML += html;
            }
        addEvents();
        } 

        function addEvents() {
            var checkBoxes = document.querySelectorAll('#taskList input[type="checkbox"]');
            for (var i in checkBoxes) {
                checkBoxes[i].onchange = updateJSON;
            }
           
        }

        function updateJSON() {
            var key = event.target.value;
            dataJSON[key].status = event.target.checked;
        }
        



//         function addEvents() {
//             var checkBoxes = document.querySelectorAll("#taskList input[type='checkbox']")
//             console.log(checkBoxes);
//             for (let i = 0; i < checkBoxes.length; i++ ) {
//                 checkBoxes[i].onchange = updateJSON;
//             }
//         }


        // console.log(dataJSON);
</script>
    
</body>
</html>